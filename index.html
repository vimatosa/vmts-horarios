<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VMTS Horarios Pro - Edici칩n Institucional</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');

body { font-family: 'Inter', sans-serif; margin:0; padding:0; background-color: #eef2f7; }
.no-print { display: block; }
.fixed-header { position: fixed; top:0; left:0; right:0; background:white; z-index:50; box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:0.5rem 1rem; display:flex; flex-wrap:wrap; align-items:center; gap:0.5rem; }
.main-container { margin-top:5rem; padding:1rem; }
.table-container { overflow-x:auto; overflow-y:auto; max-height:65vh; background:white; border-radius:0.5rem; border:1px solid #d1d5db; padding:0.5rem; }
table { border-collapse: collapse; width:100%; }
th, td { border:1px solid #d1d5db; padding:0.25rem; text-align:center; }
.bg-header { background-color:#1e3a8a; color:white; }
.select-materia, .select-maestro { width:100%; font-size:0.7rem; font-weight:bold; border:none; outline:none; background-color:#f8fafc; padding:0.2rem; border-radius:0.25rem; }
input.editable { width:100%; text-align:center; border-bottom:2px solid #1e3a8a; font-weight:bold; text-transform:uppercase; outline:none; }
.footer-logo { position:absolute; bottom:5mm; right:5mm; width:24px; height:24px; }

@media print {
  .no-print, .fixed-header { display:none; }
  body { background:white; padding:0; margin:0; }
  .print-container { padding:10mm; width:100%; }
  table, th, td { border:1px solid #000; font-size:8pt; }
  .signature-box { border-top:1px solid black; }
  .footer-logo { position:absolute; bottom:5mm; right:5mm; width:24px; height:24px; }
}
</style>
</head>
<body>

<div class="fixed-header no-print">
  <button onclick="guardarDatos()" class="px-4 py-2 bg-blue-700 text-white rounded-lg font-bold">游 Guardar</button>
  <button onclick="exportarExcel()" class="px-4 py-2 bg-green-600 text-white rounded-lg font-bold">游늵 Exportar a Excel</button>
  <button onclick="window.print()" class="px-4 py-2 bg-indigo-800 text-white rounded-lg font-bold">游둳 Imprimir / PDF</button>
</div>

<div id="root" class="main-container"></div>

<script>
const { useState, useEffect } = React;
const MATERIAS = ["LENGUA MATERNA","MATEM츼TICAS","INGL칄S","CIENCIAS (BIO)","CIENCIAS (F칈S)","CIENCIAS (QU칈)","HISTORIA","GEOGRAF칈A","FORMACI칍N C칈VICA","ARTES","EDUCACI칍N F칈SICA","TECNOLOG칈A","VIDA SALUDABLE","SOCIOEMOCIONAL","CODISE칌O"];
const DIAS = ['Lunes','Martes','Mi칠rcoles','Jueves','Viernes'];

function App() {
  const [currentGrade, setCurrentGrade] = useState('1');
  const [currentGroup, setCurrentGroup] = useState('A');
  const [view, setView] = useState('main'); // main o docentes

  const [schoolData, setSchoolData] = useState(() => {
    const saved = JSON.parse(localStorage.getItem('vmts_school_data'));
    return saved || { 
      nombre: "ESCUELA SECUNDARIA T칄CNICA",
      cicloEscolar: "2024 - 2025",
      talleres: {},
      subdirector: "Dr. V칤ctor Manuel Torreblanca S치nchez",
      director: "Mtra. Ytandehui Z칰침iga Bonilla"
    };
  });

  const [teacherList, setTeacherList] = useState(() => {
    const saved = JSON.parse(localStorage.getItem('vmts_teachers'));
    return saved || ["POR ASIGNAR"];
  });

  const [horarios, setHorarios] = useState(() => {
    const saved = JSON.parse(localStorage.getItem('vmts_horarios'));
    return saved || {};
  });

  const groupId = `${currentGrade}-${currentGroup}`;

  const updateCell = (day, mod, field, value) => {
    setHorarios(prev => ({
      ...prev,
      [groupId]: {
        ...(prev[groupId] || {}),
        [`${day}-${mod}`]: {
          ...(prev[groupId]?.[`${day}-${mod}`] || { materia: "", maestro: "" }),
          [field]: value
        }
      }
    }));
  };

  useEffect(() => {
    localStorage.setItem('vmts_school_data', JSON.stringify(schoolData));
    localStorage.setItem('vmts_teachers', JSON.stringify(teacherList));
    localStorage.setItem('vmts_horarios', JSON.stringify(horarios));
  }, [schoolData, teacherList, horarios]);

  const scheduleTimes = Array.from({length: 7}, (_, i) => ({
    start: `${7 + i}:00`,
    end: `${7 + i}:50`,
    modulo: i + 1
  }));

  if(view === 'docentes') {
    return React.createElement('div',{className:"p-4 bg-white rounded shadow"},
      React.createElement('h2',{className:"text-xl font-bold mb-4"},"Gesti칩n de Docentes"),
      teacherList.map((t,i)=>React.createElement('div',{key:i,className:"flex gap-2 mb-2 items-center"},
        React.createElement('input',{className:"editable flex-1", value:t, onChange:e=>{ const nl=[...teacherList]; nl[i]=e.target.value.toUpperCase(); setTeacherList(nl); }}),
        React.createElement('button',{className:"bg-red-600 text-white px-2 py-1 rounded", onClick:()=>setTeacherList(teacherList.filter((_,idx)=>idx!==i))},"Eliminar")
      )),
      React.createElement('button',{className:"bg-green-600 text-white px-4 py-2 rounded mt-2", onClick:()=>setTeacherList([...teacherList,"NUEVO DOCENTE"])},"+ Agregar Docente"),
      React.createElement('button',{className:"bg-blue-700 text-white px-4 py-2 rounded mt-4", onClick:()=>setView('main')},"Volver")
    );
  }

  return React.createElement('div', {className:"print-container"},
    React.createElement('div', {className:"mb-4 flex justify-between items-center"},
      React.createElement('button',{className:"bg-indigo-700 text-white px-4 py-2 rounded", onClick:()=>setView('docentes')},"Gestionar Docentes")
    ),
    React.createElement('div', {className:"mb-4"},
      React.createElement('input', {className:"editable text-2xl w-full mb-2", value: schoolData.nombre, onChange:e=>setSchoolData({...schoolData,nombre:e.target.value.toUpperCase()})}),
      React.createElement('div', {className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center"},
        React.createElement('div', {}, [
          React.createElement('label', {className:"text-xs font-bold text-slate-500 uppercase"}, "Grado y Grupo"),
          React.createElement('div', {className:"font-bold text-blue-700"}, `${currentGrade}춿 "${currentGroup}"`)
        ]),
        React.createElement('div', {}, [
          React.createElement('label', {className:"text-xs font-bold text-slate-500 uppercase"}, "Taller / Tecnolog칤a"),
          React.createElement('input',{className:"editable text-sm", placeholder:"ESPECIFIQUE TALLER", value:schoolData.talleres[groupId]||"", onChange:e=>setSchoolData({...schoolData,talleres:{...schoolData.talleres,[groupId]:e.target.value.toUpperCase()}})})
        ]),
        React.createElement('div', {}, [
          React.createElement('label', {className:"text-xs font-bold text-slate-500 uppercase"}, "Ciclo Escolar"),
          React.createElement('input',{className:"editable text-lg", value:schoolData.cicloEscolar, onChange:e=>setSchoolData({...schoolData,cicloEscolar:e.target.value.toUpperCase()})})
        ])
      )
    ),
    React.createElement('div',{className:"table-container mb-6"},
      React.createElement('table',{},
        React.createElement('thead',{},
          React.createElement('tr',{className:"bg-header"},
            React.createElement('th',{}, "HORA"),
            DIAS.map(d=>React.createElement('th',{key:d}, d))
          )
        ),
        React.createElement('tbody',{},
          scheduleTimes.map((time,i)=>{
            const mod=i+1;
            return React.createElement('tr',{key:mod},
              React.createElement('td',{className:"font-bold bg-slate-50"}, `${time.start} - ${time.end}`),
              DIAS.map(day=>{
                const cellData=horarios[groupId]?.[`${day}-${mod}`]||{materia:"",maestro:""};
                return React.createElement('td',{key:day},
                  React.createElement('div',{className:"flex flex-col gap-1"},
                    React.createElement('select',{className:"select-materia", value:cellData.materia, onChange:e=>updateCell(day,mod,'materia',e.target.value)},
                      React.createElement('option',{value:""},"- MATERIA -"),
                      MATERIAS.map(m=>React.createElement('option',{key:m,value:m},m))
                    ),
                    React.createElement('select',{className:"select-maestro", value:cellData.maestro, onChange:e=>updateCell(day,mod,'maestro',e.target.value)},
                      React.createElement('option',{value:""},"DOCENTE..."),
                      teacherList.map(t=>React.createElement('option',{key:t,value:t},t))
                    )
                  )
                )
              })
            )
          })
        )
      )
    ),
    React.createElement('div',{className:"bg-white p-6 rounded shadow relative"},
      React.createElement('div',{className:"grid grid-cols-2 gap-16 text-center mb-6"},
        React.createElement('div',{},
          React.createElement('input',{className:"editable", value:schoolData.subdirector, onChange:e=>setSchoolData({...schoolData,subdirector:e.target.value})}),
          React.createElement('p',{}, "Subdirector Operativo")
        ),
        React.createElement('div',{},
          React.createElement('input',{className:"editable", value:schoolData.director, onChange:e=>setSchoolData({...schoolData,director:e.target.value})}),
          React.createElement('p',{}, "Director del Plantel")
        )
      ),
      React.createElement('div',{className:"text-center relative"},
        React.createElement('p',{className:"text-xs uppercase font-bold text-slate-400"},"SISTEMA INSTITUCIONAL DE HORARIOS"),
        React.createElement('img',{src:"vmts.png", className:"footer-logo"})
      )
    )
  );
}

// Guardar y exportar
function guardarDatos() { alert("Los datos se guardan autom치ticamente en localStorage."); }
function exportarExcel() {
  const datos=[];
  document.querySelectorAll("table tbody tr").forEach(tr=>{
    const row=Array.from(tr.querySelectorAll("td")).map(td=>td.innerText||td.querySelector("select")?.value||"");
    datos.push(row.join(","));
  });
  const blob=new Blob([datos.join("\n")],{type:"text/csv;charset=utf-8;"});
  const enlace=document.createElement("a");
  enlace.href=URL.createObjectURL(blob);
  enlace.download="VMTS_Horarios.csv";
  enlace.click();
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
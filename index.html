<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VMTS Horarios Pro - Edici칩n Institucional</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React UMD -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/lucide.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }

    @media print {
      .no-print { display: none !important; }
      body { background: white !important; padding: 0 !important; margin: 0 !important; }
      .print-container { width: 100% !important; max-width: 100% !important; margin: 0 !important; padding: 10mm !important; }
      table { width: 100% !important; border-collapse: collapse !important; table-layout: fixed !important; }
      th, td { border: 1px solid #000 !important; font-size: 8pt !important; padding: 4px !important; }
      .bg-indigo-600 { background-color: #4f46e5 !important; color: white !important; -webkit-print-color-adjust: exact; }
      .signature-box { border-top: 1px solid black !important; }
      .footer-logo { position: absolute; bottom: 5mm; right: 5mm; width: 24px; height: 24px; }
    }

    .custom-select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236366f1'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.1rem center;
      background-size: 0.6rem;
    }
  </style>
</head>
<body>

<div class="p-4 no-print flex gap-2 mb-4">
  <button onclick="guardarDatos()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-bold flex items-center gap-2">
    游 Guardar
  </button>
  <button onclick="exportarExcel()" class="px-4 py-2 bg-green-600 text-white rounded-lg font-bold flex items-center gap-2">
    游늵 Exportar a Excel
  </button>
  <button onclick="window.print()" class="px-4 py-2 bg-indigo-800 text-white rounded-lg font-bold flex items-center gap-2">
    游둳 Imprimir / PDF
  </button>
</div>

<div id="root"></div>

<script>
const { useState, useEffect } = React;

// Datos iniciales
const MATERIAS = ["LENGUA MATERNA","MATEM츼TICAS","INGL칄S","CIENCIAS (BIO)","CIENCIAS (F칈S)","CIENCIAS (QU칈)","HISTORIA","GEOGRAF칈A","FORMACI칍N C칈VICA","ARTES","EDUCACI칍N F칈SICA","TECNOLOG칈A","VIDA SALUDABLE","SOCIOEMOCIONAL","CODISE칌O"];
const DIAS = ['Lunes','Martes','Mi칠rcoles','Jueves','Viernes'];

function App() {
  const [currentGrade, setCurrentGrade] = useState('1');
  const [currentGroup, setCurrentGroup] = useState('A');

  const [schoolData, setSchoolData] = useState(() => {
    const saved = JSON.parse(localStorage.getItem('vmts_school_data'));
    return saved || { 
      nombre: "ESCUELA SECUNDARIA T칄CNICA",
      cicloEscolar: "2024 - 2025",
      talleres: {},
      subdirector: "Dr. V칤ctor Manuel Torreblanca S치nchez",
      director: "Mtra. Ytandehui Z칰침iga Bonilla"
    };
  });

  const [teacherList, setTeacherList] = useState(() => {
    const saved = JSON.parse(localStorage.getItem('vmts_teachers'));
    return saved || ["POR ASIGNAR"];
  });

  const [horarios, setHorarios] = useState(() => {
    const saved = JSON.parse(localStorage.getItem('vmts_horarios'));
    return saved || {};
  });

  const groupId = `${currentGrade}-${currentGroup}`;

  const updateCell = (day, mod, field, value) => {
    setHorarios(prev => ({
      ...prev,
      [groupId]: {
        ...(prev[groupId] || {}),
        [`${day}-${mod}`]: {
          ...(prev[groupId]?.[`${day}-${mod}`] || { materia: "", maestro: "" }),
          [field]: value
        }
      }
    }));
  };

  useEffect(() => {
    localStorage.setItem('vmts_school_data', JSON.stringify(schoolData));
    localStorage.setItem('vmts_teachers', JSON.stringify(teacherList));
    localStorage.setItem('vmts_horarios', JSON.stringify(horarios));
  }, [schoolData, teacherList, horarios]);

  const scheduleTimes = Array.from({length: 7}, (_, i) => ({
    start: `${7 + i}:00`,
    end: `${7 + i}:50`,
    modulo: i + 1
  }));

  return (
    React.createElement('main', {className:"container mx-auto p-4 md:p-6 print-container"}, 
      React.createElement('div', {className:"bg-white p-6 rounded-t-3xl border-x border-t border-slate-200 mb-6"}, 
        React.createElement('input', {
          className:"w-full text-xl font-black text-slate-800 outline-none text-center uppercase border-b border-transparent focus:border-indigo-100 pb-2",
          value: schoolData.nombre,
          onChange: e => setSchoolData({...schoolData, nombre: e.target.value.toUpperCase()})
        }),
        React.createElement('div', {className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6 text-center"},
          React.createElement('div', {}, [
            React.createElement('label', {className:"text-[9px] font-black text-slate-400 uppercase"}, "Grado y Grupo"),
            React.createElement('div', {className:"font-black text-indigo-600 text-lg"}, `${currentGrade}춿 "${currentGroup}"`)
          ]),
          React.createElement('div', {}, [
            React.createElement('label', {className:"text-[9px] font-black text-slate-400 uppercase"}, "Taller / Tecnolog칤a"),
            React.createElement('input', {
              placeholder: "ESPECIFIQUE TALLER",
              className:"text-center font-black text-slate-800 border-b-2 border-slate-100 outline-none w-full uppercase text-xs focus:border-indigo-200",
              value: schoolData.talleres[groupId] || "",
              onChange: e => setSchoolData({...schoolData, talleres: {...schoolData.talleres, [groupId]: e.target.value.toUpperCase()}})
            })
          ]),
          React.createElement('div', {}, [
            React.createElement('label', {className:"text-[9px] font-black text-slate-400 uppercase"}, "Ciclo Escolar"),
            React.createElement('input', {
              type: "text",
              className:"w-full text-center font-black text-slate-600 border-b-2 border-slate-100 focus:border-indigo-200 text-lg outline-none",
              value: schoolData.cicloEscolar,
              onChange: e => setSchoolData({...schoolData, cicloEscolar: e.target.value.toUpperCase()})
            })
          ])
        )
      ),
      React.createElement('div', {className:"bg-white border border-slate-200 overflow-hidden mb-6"},
        React.createElement('div', {className:"overflow-x-auto"},
          React.createElement('table', {className:"w-full border-collapse"},
            React.createElement('thead', {},
              React.createElement('tr', {className:"bg-slate-900 text-white"},
                React.createElement('th', {className:"p-3 text-[9px] font-black w-24 border-r border-white/10"}, "HORA"),
                DIAS.map(d => React.createElement('th', {key:d,className:"p-3 text-[9px] font-black uppercase"}, d))
              )
            ),
            React.createElement('tbody', {},
              scheduleTimes.map((time, i) => {
                const mod = i + 1;
                return React.createElement('tr', {key:mod},
                  React.createElement('td', {className:"p-2 border border-slate-100 text-center bg-slate-50/30"},
                    React.createElement('div', {className:"text-[10px] font-black text-slate-700"}, time.start),
                    React.createElement('div', {className:"text-[8px] font-bold text-slate-400"}, time.end)
                  ),
                  DIAS.map(day => {
                    const cellData = horarios[groupId]?.[`${day}-${mod}`] || { materia: "", maestro: "" };
                    return React.createElement('td', {key:day,className:"p-1 border border-slate-100 min-w-[120px]"},
                      React.createElement('div', {className:"flex flex-col gap-1"},
                        React.createElement('select', {
                          value: cellData.materia,
                          onChange: e => updateCell(day, mod, 'materia', e.target.value),
                          className:"w-full p-1 text-[8px] font-black rounded border-none bg-transparent custom-select outline-none"
                        },
                          React.createElement('option',{value:""},"- MATERIA -"),
                          MATERIAS.map(m => React.createElement('option',{key:m,value:m}, m))
                        ),
                        React.createElement('select', {
                          value: cellData.maestro,
                          onChange: e => updateCell(day, mod, 'maestro', e.target.value),
                          className:`w-full p-0.5 text-[7px] font-bold rounded border-none outline-none ${cellData.maestro ? 'bg-indigo-50 text-indigo-700' : 'bg-slate-50 text-slate-300'}`
                        },
                          React.createElement('option',{value:""},"DOCENTE..."),
                          teacherList.map(t => React.createElement('option',{key:t,value:t}, t))
                        )
                      )
                    )
                  })
                )
              })
            )
          )
        )
      ),
      React.createElement('div', {className:"p-8 bg-white border-x border-b border-slate-200 rounded-b-3xl"},
        React.createElement('div', {className:"grid grid-cols-2 gap-32 mt-12 mb-8"},
          React.createElement('div', {className:"text-center"},
            React.createElement('input', {
              className:"w-64 text-center font-black text-slate-800 border-b-2 border-slate-900 mb-2 uppercase outline-none",
              value: schoolData.subdirector,
              onChange: e => setSchoolData({...schoolData, subdirector: e.target.value})
            }),
            React.createElement('p',{className:"text-[9px] font-black text-slate-800 uppercase"}, "Subdirector Operativo")
          ),
          React.createElement('div', {className:"text-center"},
            React.createElement('input', {
              className:"w-64 text-center font-black text-slate-800 border-b-2 border-slate-900 mb-2 uppercase outline-none",
              value: schoolData.director,
              onChange: e => setSchoolData({...schoolData, director: e.target.value})
            }),
            React.createElement('p',{className:"text-[9px] font-black text-slate-800 uppercase"}, "Director del Plantel")
          )
        ),
        React.createElement('div', {className:"text-center mt-12 relative"},
          React.createElement('p',{className:"text-[7px] font-black text-slate-300 tracking-[0.2em] uppercase"}, "SISTEMA INSTITUCIONAL DE HORARIOS"),
          React.createElement('img', {src:"vmts.png", className:"footer-logo"})
        )
      )
    )
  );
}

// Funciones guardar y exportar
function guardarDatos() {
  alert("Los datos ya se guardan autom치ticamente en esta versi칩n con React.");
}

function exportarExcel() {
  const datos = [];
  const tables = document.querySelectorAll("table tbody tr");
  tables.forEach(tr => {
    const row = Array.from(tr.querySelectorAll("td")).map(td => td.innerText || td.querySelector("select")?.value || "");
    datos.push(row.join(","));
  });
  const blob = new Blob([datos.join("\n")], { type: "text/csv;charset=utf-8;" });
  const enlace = document.createElement("a");
  enlace.href = URL.createObjectURL(blob);
  enlace.download = "VMTS_Horarios.csv";
  enlace.click();
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>

</body>
</html>